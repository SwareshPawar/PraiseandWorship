<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Praise & Worship Songs</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4fc3f7;
            --text-color: #333;
            --light-bg: #f5f7fa;
            --delete-color: #e63946;
            --sidebar-width: 250px;
            --songs-panel-width: 300px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            min-height: 100vh;
            color: var(--text-color);
            background: var(--light-bg);
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--primary-color);
            color: white;
            padding: 15px;
            position: fixed;
            left: 0;
            height: 100%;
            z-index: 1000;
            transition: transform 0.3s ease;
            overflow-y: auto;
        }

            .sidebar.hidden {
                transform: translateX(-100%);
            }

        .sidebar-header {
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-menu {
            list-style: none;
            padding: 10px 0;
        }

            .sidebar-menu li {
                margin: 8px 0;
            }

            .sidebar-menu a,
            .sidebar-btn {
                color: white;
                text-decoration: none;
                padding: 10px;
                display: flex;
                align-items: center;
                gap: 8px;
                border-radius: 4px;
                background: none;
                border: none;
                width: 100%;
                cursor: pointer;
                transition: background 0.2s;
            }

                .sidebar-menu a:hover,
                .sidebar-menu a.active,
                .sidebar-btn:hover {
                    background: var(--secondary-color);
                }

        /* Songs Section */
        .songs-section {
            width: var(--songs-panel-width);
            background: var(--light-bg);
            padding: 10px;
            position: fixed;
            left: var(--sidebar-width);
            height: 100%;
            z-index: 900;
            transition: transform 0.3s ease;
            overflow-y: auto;
        }

            .songs-section.hidden {
                transform: translateX(-100%);
            }

        .sticky-header {
            position: sticky;
            top: 0;
            background: var(--light-bg);
            z-index: 100;
            padding: 10px 0;
        }

        .filters-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .compact-input,
        .compact-select {
            padding: 6px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 0.9rem;
            width: 100%;
        }

        /* Song Item */
        .song-item {
            background: white;
            margin: 10px 0;
            padding: 12px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            cursor: pointer;
        }

            .song-item:hover {
                background: #eef3f8;
            }

        .song-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .song-meta {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 8px;
        }

        .song-actions {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        /* Preview Section */
        .preview-section {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            margin-left: calc(var(--sidebar-width) + var(--songs-panel-width));
            transition: margin-left 0.3s ease;
        }

            .preview-section.full-width {
                margin-left: 0;
            }

        .song-lyrics {
            margin-top: 20px;
            white-space: pre-wrap;
            line-height: 1.6;
            background: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .chord-line {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: -4px;
        }

        .lyric-line {
            margin-bottom: 1em;
        }

        .chord {
            color: var(--primary-color);
            font-weight: bold;
        }

        /* Buttons */
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.2s;
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
        }

            .btn-primary:hover {
                background: var(--secondary-color);
            }

        .btn-edit {
            background: #2a9d8f;
            color: white;
        }

            .btn-edit:hover {
                background: #28796e;
            }

        .btn-delete {
            background: var(--delete-color);
            color: white;
        }

            .btn-delete:hover {
                background: #b32d37;
            }

        .btn-cancel {
            background: #6c757d;
            color: white;
        }

            .btn-cancel:hover {
                background: #5a6268;
            }

        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 10px;
        }

        .tab {
            padding: 8px 15px;
            background: var(--primary-color);
            color: white;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            transition: background 0.2s;
        }

            .tab.active {
                background: var(--secondary-color);
            }

            .tab:hover {
                background: var(--secondary-color);
            }

        .tab-content {
            display: none;
        }

            .tab-content.active {
                display: block;
            }

        /* Setlist Tabs */
        .setlist-tabs {
            display: flex;
            border-bottom: 2px solid var(--primary-color);
            margin-bottom: 15px;
        }

        .setlist-tab {
            padding: 10px 20px;
            background: #e2e8f0;
            color: var(--text-color);
            border-radius: 4px 4px 0 0;
            margin-right: 5px;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            font-weight: 500;
        }

            .setlist-tab.active {
                background: var(--primary-color);
                color: white;
            }

            .setlist-tab:hover {
                background: var(--secondary-color);
                color: white;
            }

        .setlist-content {
            background: white;
            padding: 15px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 70%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5rem;
            color: var(--text-color);
            background: var(--light-bg);
            border: 1px solid var(--primary-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }

            .close-modal:hover {
                background: var(--primary-color);
                color: white;
            }

        .add-song-form,
        .edit-song-form,
        .delete-song-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

            .add-song-form input,
            .add-song-form select,
            .add-song-form textarea,
            .edit-song-form input,
            .edit-song-form select,
            .edit-song-form textarea {
                padding: 8px;
                border-radius: 4px;
                border: 1px solid #ccc;
            }

            .add-song-form textarea,
            .edit-song-form textarea {
                height: 150px;
                resize: vertical;
                font-family: monospace;
            }

        /* Toggle Buttons */
        .panel-toggle {
            position: fixed;
            z-index: 1100;
            padding: 5px;
            background: var(--primary-color);
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }

        #toggle-sidebar {
        }

        #toggle-songs {
            left: 60px;
            transition: left 0.3s ease;
        }

        #toggle-all-panels {
            left: 110px;
        }

        .sidebar.hidden ~ #toggle-songs {
            left: 60px;
        }

        /* Responsive Design */
        /* Media Queries */
        @media (max-width: 768px) {

            #toggle-sidebar {
                top: 100px;
                left: 10px; /* Match toggle-sidebar */
            }

            #toggle-songs {
                top: 140px;
                left: 10px; /* Match toggle-sidebar */
            }

            #toggle-all-panels {
                top: 180px;
                left: 10px; /* Match others */
            }

            .sidebar.hidden ~ #toggle-songs {
                left: 15px; /* Consistent indent */
            }

            .sidebar {
                width: 60%;
                max-width: none;
            }

            .songs-section {
                width: 60%;
                max-width: none;
                left: 0;
            }

            .preview-section {
                margin-left: 0;
            }





        }
    </style>
</head>
<body>
    <div class="app-container">
        <button class="panel-toggle draggable" id="toggle-sidebar"><i class="fas fa-home"></i></button>
        <button class="panel-toggle draggable" id="toggle-songs"><i class="fas fa-list"></i></button>
        <button class="panel-toggle draggable" id="toggle-all-panels"><i class="fas fa-eye-slash"></i></button>

        <div class="sidebar hidden">
            <div class="sidebar-header">
                <h2>Praise & Worship</h2>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" class="active" id="showAll">All Songs</a></li>
                <li><a href="#" id="showSetlist">Setlist</a></li>
                <li><a href="#" id="showDelete">Delete Songs</a></li>
            </ul>
            <div class="sidebar-footer">
                <button class="sidebar-btn" id="openAddSongModal">
                    <i class="fa fa-plus"></i> Add New Song
                </button>
                <button class="sidebar-btn" id="downloadSongsBtn">
                    <i class="fas fa-download"></i> Download Songs
                </button>
                <button class="sidebar-btn" id="uploadSongsBtn">
                    <i class="fas fa-upload"></i> Upload Songs
                </button>
                <button class="sidebar-btn btn-delete" id="deleteAllSongsBtn">
                    <i class="fas fa-trash-alt"></i> Delete All Songs
                </button>
            </div>
        </div>

        <div class="songs-section hidden">
            <div class="sticky-header">
                <div class="tabs">
                    <div class="setlist-tab active" id="praiseTab">Praise</div>
                    <div class="setlist-tab active" id="worshipTab">Worship</div>
                </div>
                <div class="filters-row">
                    <input type="text" id="searchInput" class="compact-input" placeholder="Search songs...">
                    <select id="keyFilter" class="compact-select">
                        <option value="">All Keys</option>
                        <option value="C">C Major</option>
                        <option value="C#">C# Major</option>
                        <option value="D">D Major</option>
                        <option value="D#">D# Major</option>
                        <option value="E">E Major</option>
                        <option value="F">F Major</option>
                        <option value="F#">F# Major</option>
                        <option value="G">G Major</option>
                        <option value="G#">G# Major</option>
                        <option value="A">A Major</option>
                        <option value="A#">A# Major</option>
                        <option value="B">B Major</option>
                        <option value="Cm">Cm</option>
                        <option value="C#m">C#m</option>
                        <option value="Dm">Dm</option>
                        <option value="D#m">D#m</option>
                        <option value="Em">Em</option>
                        <option value="Fm">Fm</option>
                        <option value="F#m">F#m</option>
                        <option value="Gm">Gm</option>
                        <option value="G#m">G#m</option>
                        <option value="Am">Am</option>
                        <option value="A#m">A#m</option>
                        <option value="Bm">Bm</option>
                    </select>
                    <select id="genreFilter" class="compact-select">
                        <option value="">All Genres</option>
                        <option value="Christmas">Christmas</option>
                        <option value="Easter">Easter</option>
                        <option value="Good Friday">Good Friday</option>
                        <option value="Thanksgiving">Thanksgiving</option>
                        <option value="Forgiveness">Forgiveness</option>
                        <option value="Holy Spirit">Holy Spirit</option>
                    </select>
                </div>
            </div>
            <div class="tab-content active" id="praiseContent"></div>
            <div class="tab-content" id="worshipContent"></div>
            <div class="setlist" id="setlistSection" style="display: none;">
                <h3>Your Setlist</h3>
                <div class="setlist-tabs">
                    <div class="setlist-tab active" id="praiseSetlistTab">Praise</div>
                    <div class="setlist-tab" id="worshipSetlistTab">Worship</div>
                </div>
                <div class="setlist-content">
                    <div id="praiseSetlistSongs"></div>
                    <div id="worshipSetlistSongs" style="display: none;"></div>
                </div>
            </div>
            <div class="delete-section" id="deleteSection" style="display: none;">
                <h3>Delete Songs</h3>
                <div id="deleteContent"></div>
            </div>
        </div>

        <div class="preview-section" id="songPreview">
            <h2>Select a song</h2>
            <div class="song-lyrics"></div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="addSongModal">
        <div class="modal-content">
            <span class="close-modal" aria-label="Close">×</span>
            <h3>Add New Song</h3>
            <form id="newSongForm" class="add-song-form">
                <label for="songTitle">Title:</label>
                <input type="text" id="songTitle" required>
                <label for="songCategory">Category:</label>
                <select id="songCategory" required>
                    <option value="praise">Praise</option>
                    <option value="worship">Worship</option>
                </select>
                <label for="songKey">Key:</label>
                <select id="songKey" required>
                    <option value="C">C Major</option>
                    <option value="C#">C# Major</option>
                    <option value="D">D Major</option>
                    <option value="D#">D# Major</option>
                    <option value="E">E Major</option>
                    <option value="F">F Major</option>
                    <option value="F#">F# Major</option>
                    <option value="G">G Major</option>
                    <option value="G#">G# Major</option>
                    <option value="A">A Major</option>
                    <option value="A#">A# Major</option>
                    <option value="B">B Major</option>
                    <option value="Cm">Cm</option>
                    <option value="C#m">C#m</option>
                    <option value="Dm">Dm</option>
                    <option value="D#m">D#m</option>
                    <option value="Em">Em</option>
                    <option value="Fm">Fm</option>
                    <option value="F#m">F#m</option>
                    <option value="Gm">Gm</option>
                    <option value="G#m">G#m</option>
                    <option value="Am">Am</option>
                    <option value="A#m">A#m</option>
                    <option value="Bm">Bm</option>
                </select>
                <label for="songTempo">Tempo (BPM):</label>
                <input type="text" id="songTempo" placeholder="e.g., 80 BPM" required>
                <label for="songTime">Time Signature:</label>
                <select id="songTime" required>
                    <option value="4/4">4/4</option>
                    <option value="3/4">3/4</option>
                    <option value="2/4">2/4</option>
                    <option value="6/8">6/8</option>
                    <option value="5/4">5/4</option>
                    <option value="7/8">7/8</option>
                </select>
                <label for="songTaal">Taal:</label>
                <select id="songTaal" required>
                    <option value="Dadra">Dadra</option>
                    <option value="Keherwa">Keherwa</option>
                    <option value="Rupak">Rupak</option>
                    <option value="EkTaal">EkTaal</option>
                    <option value="JhapTaal">JhapTaal</option>
                    <option value="TeenTaal">TeenTaal</option>
                </select>
                <label for="songGenre">Genre:</label>
                <select id="songGenre" required>
                    <option value="Christmas">Christmas</option>
                    <option value="Easter">Easter</option>
                    <option value="Good Friday">Good Friday</option>
                    <option value="Thanksgiving">Thanksgiving</option>
                    <option value="Forgiveness">Forgiveness</option>
                    <option value="Holy Spirit">Holy Spirit</option>
                </select>
                <label for="songLyrics">Lyrics:</label>
                <textarea id="songLyrics" required></textarea>
                <button type="submit" class="btn btn-primary">Add Song</button>
            </form>
        </div>
    </div>

    <div class="modal" id="editSongModal">
        <div class="modal-content">
            <span class="close-modal" aria-label="Close">×</span>
            <h3>Edit Song</h3>
            <form id="editSongForm" class="edit-song-form">
                <input type="hidden" id="editSongId">
                <label for="editSongTitle">Title:</label>
                <input type="text" id="editSongTitle" required>
                <label for="editSongCategory">Category:</label>
                <select id="editSongCategory" required>
                    <option value="praise">Praise</option>
                    <option value="worship">Worship</option>
                </select>
                <label for="editSongKey">Key:</label>
                <select id="editSongKey" required>
                    <option value="C">C Major</option>
                    <option value="C#">C# Major</option>
                    <option value="D">D Major</option>
                    <option value="D#">D# Major</option>
                    <option value="E">E Major</option>
                    <option value="F">F Major</option>
                    <option value="F#">F# Major</option>
                    <option value="G">G Major</option>
                    <option value="G#">G# Major</option>
                    <option value="A">A Major</option>
                    <option value="A#">A# Major</option>
                    <option value="B">B Major</option>
                    <option value="Cm">Cm</option>
                    <option value="C#m">C#m</option>
                    <option value="Dm">Dm</option>
                    <option value="D#m">D#m</option>
                    <option value="Em">Em</option>
                    <option value="Fm">Fm</option>
                    <option value="F#m">F#m</option>
                    <option value="Gm">Gm</option>
                    <option value="G#m">G#m</option>
                    <option value="Am">Am</option>
                    <option value="A#m">A#m</option>
                    <option value="Bm">Bm</option>
                </select>
                <label for="editSongTempo">Tempo (BPM):</label>
                <input type="text" id="editSongTempo" placeholder="e.g., 80 BPM" required>
                <label for="editSongTime">Time Signature:</label>
                <select id="editSongTime" required>
                    <option value="4/4">4/4</option>
                    <option value="3/4">3/4</option>
                    <option value="2/4">2/4</option>
                    <option value="6/8">6/8</option>
                    <option value="5/4">5/4</option>
                    <option value="7/8">7/8</option>
                </select>
                <label for="editSongTaal">Taal:</label>
                <select id="editSongTaal" required>
                    <option value="Dadra">Dadra</option>
                    <option value="Keherwa">Keherwa</option>
                    <option value="Rupak">Rupak</option>
                    <option value="EkTaal">EkTaal</option>
                    <option value="JhapTaal">JhapTaal</option>
                    <option value="TeenTaal">TeenTaal</option>
                </select>
                <label for="editSongGenre">Genre:</label>
                <select id="editSongGenre" required>
                    <option value="Christmas">Christmas</option>
                    <option value="Easter">Easter</option>
                    <option value="Good Friday">Good Friday</option>
                    <option value="Thanksgiving">Thanksgiving</option>
                    <option value="Forgiveness">Forgiveness</option>
                    <option value="Holy Spirit">Holy Spirit</option>
                </select>
                <label for="editSongLyrics">Lyrics:</label>
                <textarea id="editSongLyrics" required></textarea>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
        </div>
    </div>

    <div class="modal" id="deleteSongModal">
        <div class="modal-content">
            <span class="close-modal" aria-label="Close">×</span>
            <h3>Confirm Deletion</h3>
            <form id="deleteSongForm" class="delete-song-form">
                <input type="hidden" id="deleteSongId">
                <p id="deleteSongMessage">Are you sure you want to delete "<span id="deleteSongTitle"></span>"?</p>
                <div style="display: flex; gap: 10px;">
                    <button type="button" class="btn btn-cancel" id="cancelDeleteSong">Cancel</button>
                    <button type="submit" class="btn btn-delete">Delete</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="confirmDeleteAllModal">
        <div class="modal-content">
            <span class="close-modal" aria-label="Close">×</span>
            <h3>Confirm Delete All Songs</h3>
            <div class="delete-song-form">
                <p>Are you sure you want to delete ALL songs? This cannot be undone.</p>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-cancel" id="cancelDeleteAll">Cancel</button>
                    <button class="btn btn-delete" id="confirmDeleteAll">Delete All</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize songs
        let songs = JSON.parse(localStorage.getItem('songs')) || [
            {
                id: 1,
                title: "आनंद भरला",
                category: "praise",
                key: "G",
                tempo: "80 BPM",
                time: "4/4",
                taal: "Keherwa",
                genre: "Holy Spirit",
                lyrics: `आनंद भरला, आनंद पूर्ण भरला\nयेशूने मला वाचवले, माझे पाप धुतले,\nआनंद पूर्ण भरला\n\nमार्ग चुकून मी फिरलो, अंधकारात मी चाललो\nतरी येशूने सोडले नाही, स्वतः येउन वाचवले\nइतका चांगला येशु माझा स्वतः झाला.\n\n(Chorus)\nपापात असणारे, अंधकारात चालणारे,\nमी स्वर्गात नवे गीत गातो.\nआता पर्यंत सांभाळ केला चांगला येशु`
            },
            {
                id: 2,
                title: "Jai denewale Prabhu Yeshu ko",
                category: "praise",
                key: "D",
                tempo: "75 BPM",
                time: "4/4",
                taal: "Dadra",
                genre: "Contemporary",
                lyrics: `[D]Jai denewale Prabhu Yeshu ko koti koti [G]dhanyawad\n[A]Jeevan denewale Prabhu Yeshu ko\n[A7]jeevan bhar dhanyawad[D]\n[D]halleluiyah halleluiyah gayenge[G]\n[A]aatma se bhar kar naachenge[D]\n\nYeshu zinda hai\nwo aane wala hai\nWo sachha prabhu hai\nkaruna se bhara hua\nmeri raksha karne wala\nkabhi na sota hai\nNyaya ke hatho se\nhamko chalayega\nPrabhu mera bal hai\nkisi se na darunga\nChamtkar karne wala\naashish dene wala\nvachan ko bhejkar\nmahima badhat`
            },
            {
                id: 3,
                title: "गाऊनी स्तुती प्रभू ख्रिस्ताची",
                category: "praise",
                key: "C",
                tempo: "85 BPM",
                time: "4/4",
                taal: "TeenTaal",
                genre: "Thanksgiving",
                lyrics: `गाऊनी स्तुती प्रभू ख्रिस्ताची आनंदे नाचुनी गाऊया...(४)\nहालेलुया... हालेलुया...हालेलुया... हालेलुया...(२)\nयेशूची प्रीती किती महान माझ्या पापांसाठी केले बलिदान...(४)\nहालेलुया... हालेलुया...हालेलुया... हालेलुया...(२)\nयेशूचे रक्त किती महान पापांच्या खाचेतून सोडविते...(४)\nहालेलुया... हालेलुया...हालेलुया... हालेलुया...(२)\nयेशूची शक्ती किती महान सैतानी वारेतून सोडविते...(४)\nहालेलुया... हालेलुया...हालेलुया... हालेलुया...(२)`
            },
            {
                id: 4,
                title: "TU HI TU",
                category: "praise",
                key: "A",
                tempo: "70 BPM",
                time: "4/4",
                taal: "Rupak",
                genre: "Forgiveness",
                lyrics: `Verse 1\nHar sawaal ka jawab tu\nHar dard ka ilaaj tu\nHar ummeed ka aasha tu\nAndhero mein ujala tu\n\nChorus\nTu hi tu, tu hi tu\nYeshu tu hi tu\nTu hi tu, tu hi tu\nMera sab kuch tu hi tu\n\nVerse 2\nHar samay har gadi\nSaath na chode woh kabhi\nBaat choti ho ya badi\nDhega Yeshu tujhe aazadi\n\nBridge:\nKuch nahi chahiye sirf Yeshu kaafi hai\nKuch nahi chahiye mujhe Yeshu kaafi hai`
            }
        ];

        let praiseSetlist = JSON.parse(localStorage.getItem('praiseSetlist')) || [];
        let worshipSetlist = JSON.parse(localStorage.getItem('worshipSetlist')) || [];

        // DOM Elements
        const praiseTab = document.getElementById('praiseTab');
        const worshipTab = document.getElementById('worshipTab');
        const praiseContent = document.getElementById('praiseContent');
        const worshipContent = document.getElementById('worshipContent');
        const keyFilter = document.getElementById('keyFilter');
        const genreFilter = document.getElementById('genreFilter');
        const songPreviewEl = document.getElementById('songPreview');
        const showSetlistEl = document.getElementById('showSetlist');
        const showAllEl = document.getElementById('showAll');
        const showDeleteEl = document.getElementById('showDelete');
        const setlistSection = document.getElementById('setlistSection');
        const praiseSetlistSongs = document.getElementById('praiseSetlistSongs');
        const worshipSetlistSongs = document.getElementById('worshipSetlistSongs');
        const praiseSetlistTab = document.getElementById('praiseSetlistTab');
        const worshipSetlistTab = document.getElementById('worshipSetlistTab');
        const deleteSection = document.getElementById('deleteSection');
        const deleteContent = document.getElementById('deleteContent');
        const addSongModal = document.getElementById('addSongModal');
        const openAddSongModal = document.getElementById('openAddSongModal');
        const newSongForm = document.getElementById('newSongForm');
        const editSongModal = document.getElementById('editSongModal');
        const editSongForm = document.getElementById('editSongForm');
        const deleteSongModal = document.getElementById('deleteSongModal');
        const deleteSongForm = document.getElementById('deleteSongForm');
        const cancelDeleteSong = document.getElementById('cancelDeleteSong');
        const downloadBtn = document.getElementById('downloadSongsBtn');
        const uploadBtn = document.getElementById('uploadSongsBtn');
        const deleteAllSongsBtn = document.getElementById('deleteAllSongsBtn');
        const confirmDeleteAllModal = document.getElementById('confirmDeleteAllModal');
        const cancelDeleteAll = document.getElementById('cancelDeleteAll');
        const confirmDeleteAll = document.getElementById('confirmDeleteAll');
        const searchInput = document.getElementById('searchInput');
        const toggleSidebarBtn = document.getElementById('toggle-sidebar');
        const toggleSongsBtn = document.getElementById('toggle-songs');
        const toggleAllPanelsBtn = document.getElementById('toggle-all-panels');

        // Auto-scroll and chord variables
        let autoScrollInterval = null;
        let isUserScrolling = false;
        const CHORDS = ['C', 'C#', 'Db', 'D', 'D#', 'Eb', 'E', 'F', 'F#', 'Gb', 'G', 'G#', 'Ab', 'A', 'A#', 'Bb', 'B'];
        const CHORD_REGEX = /([A-G](?:#|b)?)(m|maj|min|dim|aug|m7|maj7|7|sus2|sus4)?/gi;
        const CHORD_LINE_REGEX = /^(\s*[A-G](?:#|b)?(?:m|maj|min|dim|aug|m7|maj7|7|sus2|sus4)?\s*)+$/i;
        const INLINE_CHORD_REGEX = /\[([A-G](?:#|b)?(?:m|maj|min|dim|aug|m7|maj7|7|sus2|sus4)?)\]/gi;

        // Save to localStorage
        function saveSongs() {
            localStorage.setItem('songs', JSON.stringify(songs));
        }

        function saveSetlists() {
            localStorage.setItem('praiseSetlist', JSON.stringify(praiseSetlist));
            localStorage.setItem('worshipSetlist', JSON.stringify(worshipSetlist));
        }

        // Initialize
        function init() {
            renderSongs('praise', '', '');
            addEventListeners();
            addPanelToggles();
        }

        // Panel Toggle Functionality
        function addPanelToggles() {
            const sidebar = document.querySelector('.sidebar');
            const songsSection = document.querySelector('.songs-section');
            const previewSection = document.querySelector('.preview-section');

            if (!sidebar || !songsSection || !previewSection || !toggleSidebarBtn || !toggleSongsBtn || !toggleAllPanelsBtn) {
                console.error('One or more elements not found for panel toggles');
                return;
            }

            toggleSidebarBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                sidebar.classList.toggle('hidden');
                updatePositions();
            });

            toggleSongsBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                songsSection.classList.toggle('hidden');
                updatePositions();
            });

            toggleAllPanelsBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const areBothHidden = sidebar.classList.contains('hidden') && songsSection.classList.contains('hidden');
                sidebar.classList.toggle('hidden', !areBothHidden);
                songsSection.classList.toggle('hidden', !areBothHidden);
                toggleAllPanelsBtn.querySelector('i').className = areBothHidden ? 'fas fa-eye-slash' : 'fas fa-eye';
                updatePositions();
            });

            document.addEventListener('click', (e) => {
                if (window.innerWidth <= 768 &&
                    !e.target.closest('.sidebar') &&
                    !e.target.closest('.songs-section') &&
                    !e.target.closest('.panel-toggle') &&
                    !e.target.closest('.modal')) {
                    sidebar.classList.add('hidden');
                    songsSection.classList.add('hidden');
                    toggleAllPanelsBtn.querySelector('i').className = 'fas fa-eye';
                    updatePositions();
                }
            });

            function updatePositions() {
                if (window.innerWidth > 768) {
                    if (sidebar.classList.contains('hidden')) {
                        songsSection.style.left = '0';
                        previewSection.style.marginLeft = songsSection.classList.contains('hidden') ? '0' : 'var(--songs-panel-width)';
                    } else {
                        songsSection.style.left = 'var(--sidebar-width)';
                        previewSection.style.marginLeft = songsSection.classList.contains('hidden') ? 'var(--sidebar-width)' : 'calc(var(--sidebar-width) + var(--songs-panel-width))';
                    }
                } else {
                    songsSection.style.left = '0';
                    previewSection.style.marginLeft = '0';
                    previewSection.classList.add('full-width');
                }
            }

            if (window.innerWidth > 768) {
                sidebar.classList.remove('hidden');
                songsSection.classList.remove('hidden');
            } else {
                sidebar.classList.add('hidden');
                songsSection.classList.add('hidden');
            }
            updatePositions();

            window.addEventListener('resize', updatePositions);
        }

        // Event Listeners
        function addEventListeners() {
            praiseTab.addEventListener('click', () => {
                setlistSection.style.display = 'none';
                deleteSection.style.display = 'none';
                praiseTab.classList.add('active');
                worshipTab.classList.remove('active');
                praiseContent.classList.add('active');
                worshipContent.classList.remove('active');
                renderSongs('praise', keyFilter.value, genreFilter.value);
            });

            worshipTab.addEventListener('click', () => {
                setlistSection.style.display = 'none';
                deleteSection.style.display = 'none';
                worshipTab.classList.add('active');
                praiseTab.classList.remove('active');
                worshipContent.classList.add('active');
                praiseContent.classList.remove('active');
                renderSongs('worship', keyFilter.value, genreFilter.value);
            });

            keyFilter.addEventListener('change', () => {
                if (praiseTab.classList.contains('active')) {
                    renderSongs('praise', keyFilter.value, genreFilter.value);
                } else {
                    renderSongs('worship', keyFilter.value, genreFilter.value);
                }
            });

            genreFilter.addEventListener('change', () => {
                if (praiseTab.classList.contains('active')) {
                    renderSongs('praise', keyFilter.value, genreFilter.value);
                } else {
                    renderSongs('worship', keyFilter.value, genreFilter.value);
                }
            });

            showSetlistEl.addEventListener('click', (e) => {
                e.preventDefault();
                praiseContent.classList.remove('active');
                worshipContent.classList.remove('active');
                setlistSection.style.display = 'block';
                deleteSection.style.display = 'none';
                praiseSetlistTab.classList.add('active');
                worshipSetlistTab.classList.remove('active');
                praiseSetlistSongs.style.display = 'block';
                worshipSetlistSongs.style.display = 'none';
                renderSetlist('praise');
                showSetlistEl.classList.add('active');
                showAllEl.classList.remove('active');
                showDeleteEl.classList.remove('active');
            });

            showAllEl.addEventListener('click', (e) => {
                e.preventDefault();
                praiseContent.classList.add('active');
                worshipContent.classList.remove('active');
                setlistSection.style.display = 'none';
                deleteSection.style.display = 'none';
                renderSongs('praise', keyFilter.value, genreFilter.value);
                showAllEl.classList.add('active');
                showSetlistEl.classList.remove('active');
                showDeleteEl.classList.remove('active');
            });

            showDeleteEl.addEventListener('click', (e) => {
                e.preventDefault();
                praiseContent.classList.remove('active');
                worshipContent.classList.remove('active');
                setlistSection.style.display = 'none';
                deleteSection.style.display = 'block';
                renderDeleteSongs();
                showDeleteEl.classList.add('active');
                showAllEl.classList.remove('active');
                showSetlistEl.classList.remove('active');
            });

            praiseSetlistTab.addEventListener('click', () => {
                praiseSetlistTab.classList.add('active');
                worshipSetlistTab.classList.remove('active');
                praiseSetlistSongs.style.display = 'block';
                worshipSetlistSongs.style.display = 'none';
                renderSetlist('praise');
            });

            worshipSetlistTab.addEventListener('click', () => {
                worshipSetlistTab.classList.add('active');
                praiseSetlistTab.classList.remove('active');
                worshipSetlistSongs.style.display = 'block';
                praiseSetlistSongs.style.display = 'none';
                renderSetlist('worship');
            });

            openAddSongModal.addEventListener('click', () => {
                addSongModal.style.display = 'flex';
            });

            document.querySelectorAll('.close-modal').forEach(button => {
                button.addEventListener('click', () => {
                    button.closest('.modal').style.display = 'none';
                });
            });

            newSongForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const newSong = {
                    id: Math.max(...songs.map(s => s.id), 0) + 1,
                    title: document.getElementById('songTitle').value,
                    category: document.getElementById('songCategory').value,
                    key: document.getElementById('songKey').value,
                    tempo: document.getElementById('songTempo').value,
                    time: document.getElementById('songTime').value,
                    taal: document.getElementById('songTaal').value,
                    genre: document.getElementById('songGenre').value,
                    lyrics: document.getElementById('songLyrics').value
                };
                songs.push(newSong);
                saveSongs();
                if (deleteSection.style.display === 'block') {
                    renderDeleteSongs();
                } else if (praiseTab.classList.contains('active')) {
                    renderSongs('praise', keyFilter.value, genreFilter.value);
                } else {
                    renderSongs('worship', keyFilter.value, genreFilter.value);
                }
                addSongModal.style.display = 'none';
                newSongForm.reset();
            });

            editSongForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const id = parseInt(document.getElementById('editSongId').value);
                const updatedSong = {
                    id,
                    title: document.getElementById('editSongTitle').value,
                    category: document.getElementById('editSongCategory').value,
                    key: document.getElementById('editSongKey').value,
                    tempo: document.getElementById('editSongTempo').value,
                    time: document.getElementById('editSongTime').value,
                    taal: document.getElementById('editSongTaal').value,
                    genre: document.getElementById('editSongGenre').value,
                    lyrics: document.getElementById('editSongLyrics').value
                };

                songs = songs.map(song => song.id === id ? updatedSong : song);
                saveSongs();

                praiseSetlist = praiseSetlist.map(song => song.id === id ? updatedSong : song);
                worshipSetlist = worshipSetlist.map(song => song.id === id ? updatedSong : song);
                saveSetlists();

                if (deleteSection.style.display === 'block') {
                    renderDeleteSongs();
                } else if (setlistSection.style.display === 'block') {
                    renderSetlist(praiseSetlistTab.classList.contains('active') ? 'praise' : 'worship');
                } else if (praiseTab.classList.contains('active')) {
                    renderSongs('praise', keyFilter.value, genreFilter.value);
                } else {
                    renderSongs('worship', keyFilter.value, genreFilter.value);
                }

                if (songPreviewEl.dataset.songId == id) {
                    showPreview(updatedSong);
                }

                editSongModal.style.display = 'none';
                editSongForm.reset();
            });

            cancelDeleteSong.addEventListener('click', () => {
                deleteSongModal.style.display = 'none';
            });

            deleteSongForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const id = parseInt(document.getElementById('deleteSongId').value);
                songs = songs.filter(s => s.id !== id);
                saveSongs();

                praiseSetlist = praiseSetlist.filter(s => s.id !== id);
                worshipSetlist = worshipSetlist.filter(s => s.id !== id);
                saveSetlists();

                if (songPreviewEl.dataset.songId == id) {
                    songPreviewEl.innerHTML = '<h2>Select a song</h2><div class="song-lyrics"></div>';
                    songPreviewEl.dataset.songId = '';
                    if (autoScrollInterval) {
                        clearInterval(autoScrollInterval);
                        autoScrollInterval = null;
                    }
                }

                renderDeleteSongs();
                deleteSongModal.style.display = 'none';
            });

            songPreviewEl.addEventListener('wheel', handleUserScroll);
            songPreviewEl.addEventListener('touchmove', handleUserScroll);

            deleteAllSongsBtn.addEventListener('click', () => {
                confirmDeleteAllModal.style.display = 'flex';
            });

            cancelDeleteAll.addEventListener('click', () => {
                confirmDeleteAllModal.style.display = 'none';
            });

            confirmDeleteAll.addEventListener('click', () => {
                songs = [];
                praiseSetlist = [];
                worshipSetlist = [];
                saveSongs();
                saveSetlists();
                if (praiseTab.classList.contains('active')) {
                    renderSongs('praise', keyFilter.value, genreFilter.value);
                } else {
                    renderSongs('worship', keyFilter.value, genreFilter.value);
                }
                songPreviewEl.innerHTML = '<h2>Select a song</h2><div class="song-lyrics"></div>';
                songPreviewEl.dataset.songId = '';
                confirmDeleteAllModal.style.display = 'none';
                alert('All songs have been deleted.');
            });

            searchInput.addEventListener('input', function (e) {
                const query = e.target.value.trim().toLowerCase();
                if (query.length === 0) {
                    if (praiseTab.classList.contains('active')) {
                        renderSongs('praise', keyFilter.value, genreFilter.value);
                    } else {
                        renderSongs('worship', keyFilter.value, genreFilter.value);
                    }
                    return;
                }
                const filtered = songs.filter(song => {
                    return (
                        song.title.toLowerCase().includes(query) ||
                        (song.lyrics && song.lyrics.toLowerCase().includes(query)) ||
                        (song.taal && song.taal.toLowerCase().includes(query)) ||
                        (song.genre && song.genre.toLowerCase().includes(query))
                    );
                });
                if (praiseTab.classList.contains('active')) {
                    renderSongs(filtered.filter(s => s.category === 'praise'), praiseContent);
                } else {
                    renderSongs(filtered.filter(s => s.category === 'worship'), worshipContent);
                }
            });

            downloadBtn.addEventListener('click', downloadSongs);
            uploadBtn.addEventListener('click', () => {
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '.json';
                fileInput.style.display = 'none';
                fileInput.addEventListener('change', handleFileUpload);
                document.body.appendChild(fileInput);
                fileInput.click();
                document.body.removeChild(fileInput);
            });
        }

        // Handle user scroll
        function handleUserScroll() {
            isUserScrolling = true;
            if (autoScrollInterval) {
                clearInterval(autoScrollInterval);
                autoScrollInterval = null;
            }
        }

        // Render songs
        function renderSongs(categoryOrSongs, filterOrContainer, genreFilterValue) {
            let songsToRender;
            let container;
            if (typeof categoryOrSongs === 'string') {
                const category = categoryOrSongs;
                const keyFilterValue = filterOrContainer;
                songsToRender = songs
                    .filter(song => song.category === category)
                    .filter(song => keyFilterValue === "" || song.key === keyFilterValue)
                    .filter(song => genreFilterValue === "" || song.genre === genreFilterValue)
                    .sort((a, b) => a.title.localeCompare(b.title));
                container = category === 'praise' ? praiseContent : worshipContent;
            } else {
                songsToRender = categoryOrSongs;
                container = filterOrContainer;
            }
            container.innerHTML = '';
            if (songsToRender.length === 0) {
                container.innerHTML = '<p>No songs found.</p>';
                return;
            }
            songsToRender.forEach(song => {
                const div = document.createElement('div');
                div.className = 'song-item';
                div.dataset.songId = song.id;
                div.innerHTML = `
                        <div class="song-title">${song.title}</div>
                        <div class="song-meta">${song.key} | ${song.tempo} | ${song.time} | ${song.taal || ''} | ${song.genre || ''}</div>
                        <div class="song-actions">
                            <button class="btn btn-primary add-to-setlist">Add to Setlist</button>
                            <button class="btn btn-edit edit-song">Edit</button>
                        </div>
                    `;
                div.querySelector('.add-to-setlist').addEventListener('click', (e) => {
                    e.stopPropagation();
                    addToSetlist(song.id);
                });
                div.querySelector('.edit-song').addEventListener('click', (e) => {
                    e.stopPropagation();
                    editSong(song.id);
                });
                div.addEventListener('click', () => {
                    showPreview(song);
                    if (window.innerWidth <= 768) {
                        document.querySelector('.songs-section').classList.add('hidden');
                        document.querySelector('.sidebar').classList.add('hidden');
                        document.querySelector('.preview-section').classList.add('full-width');
                    }
                });
                container.appendChild(div);
            });
        }

        // Render delete songs
        function renderDeleteSongs() {
            deleteContent.innerHTML = '';
            if (songs.length === 0) {
                deleteContent.innerHTML = '<p>No songs available to delete.</p>';
                return;
            }
            songs
                .sort((a, b) => a.title.localeCompare(b.title))
                .forEach(song => {
                    const div = document.createElement('div');
                    div.className = 'song-item';
                    div.innerHTML = `
                            <div class="song-title">${song.title}</div>
                            <div class="song-meta">${song.key} | ${song.tempo} | ${song.time} | ${song.genre} | ${song.category}</div>
                            <div class="song-actions">
                                <button class="btn btn-delete delete-song">Delete</button>
                            </div>
                        `;
                    div.querySelector('.delete-song').addEventListener('click', () => {
                        openDeleteSongModal(song.id);
                    });
                    deleteContent.appendChild(div);
                });
        }

        // Open delete modal
        function openDeleteSongModal(id) {
            const song = songs.find(s => s.id === id);
            if (!song) return;
            document.getElementById('deleteSongId').value = song.id;
            document.getElementById('deleteSongTitle').textContent = song.title;
            deleteSongModal.style.display = 'flex';
        }

        // Clean lyrics
        function cleanUpLyrics(lyrics) {
            return lyrics.replace(/\n{3,}/g, '\n\n');
        }

        // Show preview
        function showPreview(song) {
            songPreviewEl.dataset.songId = song.id;
            songPreviewEl.dataset.originalLyrics = song.lyrics;
            songPreviewEl.dataset.originalKey = song.key;
            const displayLyrics = cleanUpLyrics(song.lyrics);
            songPreviewEl.innerHTML = `
                    <h2>${song.title}</h2>
                    <div class="song-meta">
                        <p><strong>Key:</strong> <span id="current-key">${song.key}</span></p>
                        <p><strong>Tempo:</strong> ${song.tempo}</p>
                        <p><strong>Time Signature:</strong> ${song.time}</p>
                        ${song.taal ? `<p><strong>Taal:</strong> ${song.taal}</p>` : ''}
                        ${song.genre ? `<p><strong>Genre:</strong> ${song.genre}</p>` : ''}
                    </div>
                    <div class="transpose-controls">
                        <button class="btn btn-primary" id="transpose-down">-</button>
                        <span>Transpose: <span id="transpose-level">0</span></span>
                        <button class="btn btn-primary" id="transpose-up">+</button>
                    </div>
                    <div class="song-lyrics">${formatLyricsWithChords(displayLyrics, 0)}</div>
                `;
            document.getElementById('transpose-up').addEventListener('click', () => {
                const currentLevel = parseInt(document.getElementById('transpose-level').textContent);
                updatePreviewWithTransposition(currentLevel + 1);
            });
            document.getElementById('transpose-down').addEventListener('click', () => {
                const currentLevel = parseInt(document.getElementById('transpose-level').textContent);
                updatePreviewWithTransposition(currentLevel - 1);
            });
            setupAutoScroll();
        }

        // Format lyrics with chords
        function formatLyricsWithChords(lyrics, transposeLevel) {
            const cleanedLyrics = cleanUpLyrics(lyrics);
            const lines = cleanedLyrics.split('\n');
            let output = [];
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line === '' && i > 0 && lines[i - 1].trim() === '') {
                    continue;
                }
                if (line.match(CHORD_LINE_REGEX)) {
                    const chordLine = line.replace(CHORD_REGEX, (match, base, quality) => {
                        const chord = base + (quality || '');
                        return `<span class="chord" data-original="${chord}">${transposeChord(chord, transposeLevel)}</span> `;
                    });
                    output.push(`<div class="chord-line">${chordLine}</div>`);
                } else if (line.includes('[') && line.includes(']')) {
                    const formattedLine = line.replace(INLINE_CHORD_REGEX, (match, chord) => {
                        return `[<span class="chord" data-original="${chord}">${transposeChord(chord, transposeLevel)}</span>]`;
                    });
                    output.push(`<div class="lyric-line">${formattedLine}</div>`);
                } else {
                    output.push(`<div class="lyric-line">${line}</div>`);
                }
            }
            return output.join('');
        }

        // Transpose chord
        function transposeChord(chord, steps) {
            if (steps === 0 || !chord) return chord;

            const match = chord.match(/^([A-G][#b]?)(.*)$/i);
            if (!match) return chord;

            const baseNote = match[1];
            const quality = match[2] || '';

            const normalizedNote = baseNote.replace('b', '#').toUpperCase();
            let currentIndex = CHORDS.indexOf(normalizedNote);
            if (currentIndex === -1) {
                const flatToSharp = { 'Db': 'C#', 'Eb': 'D#', 'Gb': 'F#', 'Ab': 'G#', 'Bb': 'A#' };
                const sharpNote = flatToSharp[baseNote];
                if (sharpNote) {
                    currentIndex = CHORDS.indexOf(sharpNote);
                }
                if (currentIndex === -1) return chord;
            }

            const newIndex = (currentIndex + steps + CHORDS.length) % CHORDS.length;
            let newBaseNote = CHORDS[newIndex];

            const preferFlat = ['F', 'Bb', 'Eb', 'Ab', 'Db'];
            if (preferFlat.includes(newBaseNote)) {
                const sharpToFlat = { 'C#': 'Db', 'D#': 'Eb', 'F#': 'Gb', 'G#': 'Ab', 'A#': 'Bb' };
                newBaseNote = sharpToFlat[newBaseNote] || newBaseNote;
            }

            return newBaseNote + quality;
        }

        // Update preview with transposition
        function updatePreviewWithTransposition(level) {
            const lyrics = songPreviewEl.dataset.originalLyrics;
            document.getElementById('transpose-level').textContent = level;
            const originalKey = songPreviewEl.dataset.originalKey;
            document.getElementById('current-key').textContent = level === 0 ? originalKey : transposeChord(originalKey, level);
            document.querySelector('.song-lyrics').innerHTML = formatLyricsWithChords(lyrics, level);
        }

        // Setup auto-scroll
        function setupAutoScroll() {
            isUserScrolling = false;
            songPreviewEl.scrollTop = 0;
            if (autoScrollInterval) {
                clearInterval(autoScrollInterval);
                autoScrollInterval = null;
            }
            autoScrollInterval = setInterval(() => {
                if (isUserScrolling) return;
                const previewHeight = songPreviewEl.scrollHeight;
                const viewportHeight = songPreviewEl.clientHeight;
                const maxScroll = previewHeight - viewportHeight;
                const currentScroll = songPreviewEl.scrollTop;
                const scrollStep = 20;
                if (currentScroll >= maxScroll - 10 || maxScroll <= 0) {
                    clearInterval(autoScrollInterval);
                    autoScrollInterval = null;
                    return;
                }
                const targetScroll = Math.min(currentScroll + scrollStep, maxScroll);
                let startTime;
                function animateScroll(timestamp) {
                    if (!startTime) startTime = timestamp;
                    const progress = Math.min((timestamp - startTime) / 300, 1);
                    const ease = progress * (2 - progress);
                    songPreviewEl.scrollTop = currentScroll + (targetScroll - currentScroll) * ease;
                    if (progress < 1 && !isUserScrolling) {
                        requestAnimationFrame(animateScroll);
                    }
                }
                requestAnimationFrame(animateScroll);
            }, 2000);
        }

        // Add to setlist
        function addToSetlist(id) {
            const song = songs.find(s => s.id === id);
            const setlist = song.category === 'praise' ? praiseSetlist : worshipSetlist;
            if (!setlist.some(s => s.id === id)) {
                setlist.push(song);
                saveSetlists();
                if (setlistSection.style.display === 'block' &&
                    (song.category === 'praise' && praiseSetlistTab.classList.contains('active') ||
                        song.category === 'worship' && worshipSetlistTab.classList.contains('active'))) {
                    renderSetlist(song.category);
                }
            }
        }

        // Edit song
        function editSong(id) {
            const song = songs.find(s => s.id === id);
            if (!song) return;
            document.getElementById('editSongId').value = song.id;
            document.getElementById('editSongTitle').value = song.title;
            document.getElementById('editSongCategory').value = song.category;
            document.getElementById('editSongKey').value = song.key;
            document.getElementById('editSongTempo').value = song.tempo;
            document.getElementById('editSongTime').value = song.time;
            document.getElementById('editSongTaal').value = song.taal;
            document.getElementById('editSongGenre').value = song.genre;
            document.getElementById('editSongLyrics').value = song.lyrics;
            editSongModal.style.display = 'flex';
        }

        // Remove from setlist
        function removeFromSetlist(id, category) {
            if (category === 'praise') {
                praiseSetlist = praiseSetlist.filter(s => s.id !== id);
            } else {
                worshipSetlist = worshipSetlist.filter(s => s.id !== id);
            }
            saveSetlists();
            renderSetlist(category);
        }

        // Render setlist
        function renderSetlist(category) {
            const container = category === 'praise' ? praiseSetlistSongs : worshipSetlistSongs;
            const setlist = category === 'praise' ? praiseSetlist : worshipSetlist;
            container.innerHTML = '';
            if (setlist.length === 0) {
                container.innerHTML = '<p>Your ' + category + ' setlist is empty.</p>';
                return;
            }
            const ul = document.createElement('ul');
            ul.style.listStyle = 'none';
            ul.style.padding = '0';
            setlist.forEach(song => {
                const li = document.createElement('li');
                li.style.display = 'flex';
                li.style.justifyContent = 'space-between';
                li.style.padding = '10px';
                li.style.marginBottom = '8px';
                li.style.background = '#f5f7fa';
                li.style.borderRadius = '5px';
                li.innerHTML = `
                        <span>${song.title} (${song.key} | ${song.genre})</span>
                        <div class="song-actions">
                            <button class="btn btn-primary" onclick="removeFromSetlist(${song.id}, '${song.category}')">Remove</button>
                        </div>
                    `;
                li.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('btn')) {
                        showPreview(song);
                    }
                });
                ul.appendChild(li);
            });
            container.appendChild(ul);
        }

        // Download songs
        function downloadSongs() {
            const data = {
                songs: songs,
                praiseSetlist: praiseSetlist,
                worshipSetlist: worshipSetlist
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'worship-songs.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Handle file upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.songs && Array.isArray(data.songs)) {
                        songs = data.songs;
                        praiseSetlist = data.praiseSetlist || [];
                        worshipSetlist = data.worshipSetlist || [];
                        saveSongs();
                        saveSetlists();
                        if (praiseTab.classList.contains('active')) {
                            renderSongs('praise', keyFilter.value, genreFilter.value);
                        } else {
                            renderSongs('worship', keyFilter.value, genreFilter.value);
                        }
                        alert('Songs loaded successfully!');
                    } else {
                        throw new Error('Invalid file format');
                    }
                } catch (err) {
                    alert('Could not load file: ' + err.message);
                }
            };
            reader.onerror = function () {
                alert('Error reading file');
            };
            reader.readAsText(file);
        }

        // Global functions
        window.addToSetlist = addToSetlist;
        window.editSong = editSong;
        window.openDeleteSongModal = openDeleteSongModal;
        window.removeFromSetlist = removeFromSetlist;

        // Start app
        window.onload = init;
    </script>

<style>
    .panel-toggle.draggable {
        position: fixed;
        cursor: grab;
        user-select: none;
        touch-action: none;
        opacity: 0.2;
        transition: opacity 0.4s ease, transform 0.3s ease;
        z-index: 2000;
    }

    .panel-toggle.draggable:hover,
    .panel-toggle.draggable.showing {
        opacity: 1;
    }

    .panel-toggle::after {
        content: '';
        position: absolute;
        top: -6px;
        right: -6px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background-color: var(--accent-color);
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% { transform: scale(1); opacity: 0.8; }
        50% { transform: scale(1.5); opacity: 0.4; }
        100% { transform: scale(1); opacity: 0.8; }
    }
</style>
<script>
    function makeToggleDraggable(id) {
        const el = document.getElementById(id);
        let isDragging = false, offsetX = 0, offsetY = 0;

        const savePosition = () => {
            const pos = { top: el.style.top, left: el.style.left };
            localStorage.setItem(id + '-pos', JSON.stringify(pos));
        };

        const restorePosition = () => {
            const saved = localStorage.getItem(id + '-pos');
            if (saved) {
                const pos = JSON.parse(saved);
                el.style.top = pos.top;
                el.style.left = pos.left;
            }
        };

        const onMove = (clientX, clientY) => {
            el.style.left = clientX - offsetX + 'px';
            el.style.top = clientY - offsetY + 'px';
        };

        const onEnd = () => {
            isDragging = false;
            document.body.style.userSelect = '';
            const windowWidth = window.innerWidth;
            const elRect = el.getBoundingClientRect();
            if (elRect.left < windowWidth / 2) {
                el.style.left = '10px';
            } else {
                el.style.left = (windowWidth - el.offsetWidth - 10) + 'px';
            }
            savePosition();
        };

        el.addEventListener('mousedown', function (e) {
            isDragging = true;
            offsetX = e.clientX - el.offsetLeft;
            offsetY = e.clientY - el.offsetTop;
            document.body.style.userSelect = 'none';
        });

        document.addEventListener('mousemove', function (e) {
            if (isDragging) onMove(e.clientX, e.clientY);
        });

        document.addEventListener('mouseup', onEnd);

        el.addEventListener('touchstart', function (e) {
            isDragging = true;
            const touch = e.touches[0];
            offsetX = touch.clientX - el.offsetLeft;
            offsetY = touch.clientY - el.offsetTop;
        }, { passive: false });

        el.addEventListener('touchmove', function (e) {
            if (isDragging) {
                const touch = e.touches[0];
                onMove(touch.clientX, touch.clientY);
            }
        }, { passive: false });

        el.addEventListener('touchend', onEnd);
        restorePosition();

        let timeout;
        const showTemporarily = () => {
            el.classList.add('showing');
            clearTimeout(timeout);
            timeout = setTimeout(() => {
                el.classList.remove('showing');
            }, 3000);
        };

        el.addEventListener('mouseenter', () => el.classList.add('showing'));
        el.addEventListener('mouseleave', () => el.classList.remove('showing'));
        el.addEventListener('touchstart', showTemporarily, { passive: true });
    }

    window.addEventListener('DOMContentLoaded', () => {
        makeToggleDraggable('toggle-sidebar');
        makeToggleDraggable('toggle-songs');
        makeToggleDraggable('toggle-all-panels');
    });
</script>


<style>
    #settingsBtn {
        position: absolute;
        bottom: 15px;
        left: 15px;
        padding: 6px 12px;
        background: var(--accent-color);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        z-index: 1001;
    }

    .draggable-menu-item {
        cursor: grab;
        user-select: none;
    }
</style>

<div class="modal" id="settingsModal">
    <div class="modal-content">
        <span class="close-modal" onclick="document.getElementById('settingsModal').style.display='none'">×</span>
        <h3>Settings</h3>
        <form id="settingsForm">
            <label for="sidebarHeaderInput">Sidebar Header:</label>
            <input type="text" id="sidebarHeaderInput" required>
            <label for="setlistTextInput">Setlist Menu Text:</label>
            <input type="text" id="setlistTextInput" required>
            <button type="submit" class="btn btn-primary">Save Settings</button>
        </form>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const headerEl = document.querySelector(".sidebar-header h2");
        const setlistEl = document.getElementById("showSetlist");

        // Create and add settings button
        const settingsBtn = document.createElement("button");
        settingsBtn.id = "settingsBtn";
        settingsBtn.textContent = "⚙️ Settings";
        document.querySelector(".app-container").appendChild(settingsBtn);

        // Restore saved settings
        const savedHeader = localStorage.getItem("sidebarHeader");
        if (savedHeader) headerEl.textContent = savedHeader;

        const savedSetlistLabel = localStorage.getItem("setlistText");
        if (savedSetlistLabel) setlistEl.textContent = savedSetlistLabel;

        // Settings modal open
        settingsBtn.addEventListener("click", () => {
            document.getElementById("sidebarHeaderInput").value = headerEl.textContent;
            document.getElementById("setlistTextInput").value = setlistEl.textContent;
            document.getElementById("settingsModal").style.display = "flex";
        });

        // Save settings to DOM + localStorage
        document.getElementById("settingsForm").addEventListener("submit", function (e) {
            e.preventDefault();
            const newHeader = document.getElementById("sidebarHeaderInput").value;
            const newSetlist = document.getElementById("setlistTextInput").value;

            headerEl.textContent = newHeader;
            setlistEl.textContent = newSetlist;

            localStorage.setItem("sidebarHeader", newHeader);
            localStorage.setItem("setlistText", newSetlist);

            document.getElementById("settingsModal").style.display = "none";
        });

        // Make sidebar menu items draggable + reorderable
        const menu = document.querySelector(".sidebar-menu");
        const items = Array.from(menu.children);

        const saveMenuOrder = () => {
            const ids = Array.from(menu.children).map(li => li.id || li.textContent.trim());
            localStorage.setItem("menuOrder", JSON.stringify(ids));
        };

        const restoreMenuOrder = () => {
            const order = JSON.parse(localStorage.getItem("menuOrder") || "[]");
            const map = {};
            Array.from(menu.children).forEach(li => {
                const id = li.id || li.textContent.trim();
                map[id] = li;
            });
            order.forEach(id => {
                if (map[id]) menu.appendChild(map[id]);
            });
        };

        items.forEach(li => {
            li.classList.add("draggable-menu-item");
            li.setAttribute("draggable", "true");

            li.addEventListener("dragstart", (e) => {
                e.dataTransfer.setData("text/plain", li.id || li.textContent.trim());
                li.style.opacity = "0.5";
            });

            li.addEventListener("dragend", () => {
                li.style.opacity = "1";
                saveMenuOrder();
            });

            li.addEventListener("dragover", (e) => e.preventDefault());

            li.addEventListener("drop", (e) => {
                e.preventDefault();
                const draggedId = e.dataTransfer.getData("text/plain");
                const draggedEl = document.getElementById(draggedId) || Array.from(menu.children).find(el => el.textContent.trim() === draggedId);
                if (draggedEl && draggedEl !== li) {
                    menu.insertBefore(draggedEl, li.nextSibling);
                }
            });
        });

        restoreMenuOrder();
    });
</script>


<script>
    document.addEventListener("DOMContentLoaded", () => {
        const menu = document.querySelector(".sidebar-menu");

        const saveSidebarOrder = () => {
            const ids = Array.from(menu.children).map(li => li.id || li.textContent.trim());
            localStorage.setItem("sidebarMenuOrder", JSON.stringify(ids));
        };

        const restoreSidebarOrder = () => {
            const order = JSON.parse(localStorage.getItem("sidebarMenuOrder") || "[]");
            const itemMap = {};
            Array.from(menu.children).forEach(li => {
                const key = li.id || li.textContent.trim();
                itemMap[key] = li;
            });
            order.forEach(key => {
                if (itemMap[key]) {
                    menu.appendChild(itemMap[key]);
                }
            });
        };

        Array.from(menu.children).forEach(li => {
            li.classList.add("draggable-menu-item");
            li.setAttribute("draggable", "true");

            li.addEventListener("dragstart", (e) => {
                e.dataTransfer.setData("text/plain", li.id || li.textContent.trim());
                li.style.opacity = "0.5";
            });

            li.addEventListener("dragend", () => {
                li.style.opacity = "1";
                saveSidebarOrder();
            });

            li.addEventListener("dragover", (e) => e.preventDefault());

            li.addEventListener("drop", (e) => {
                e.preventDefault();
                const draggedKey = e.dataTransfer.getData("text/plain");
                const draggedEl = document.getElementById(draggedKey) || Array.from(menu.children).find(el => el.textContent.trim() === draggedKey);
                if (draggedEl && draggedEl !== li) {
                    menu.insertBefore(draggedEl, li.nextSibling);
                }
            });
        });

        restoreSidebarOrder();
    });
</script>


<style>
    .setlist-sortable li {
        cursor: grab;
        transition: background 0.3s;
    }

    .setlist-sortable li:hover {
        background-color: #e0f0ff;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    .setlist-index {
        font-weight: bold;
        margin-right: 10px;
        color: var(--primary-color);
    }
</style>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        function makeSetlistDraggable(category) {
            const container = category === 'praise' ? document.getElementById('praiseSetlistSongs') : document.getElementById('worshipSetlistSongs');
            const setlist = category === 'praise' ? praiseSetlist : worshipSetlist;

            container.innerHTML = '';
            if (setlist.length === 0) {
                container.innerHTML = `<p>Your ${category} setlist is empty.</p>`;
                return;
            }

            const ul = document.createElement('ul');
            ul.className = 'setlist-sortable';
            ul.style.listStyle = 'none';
            ul.style.padding = '0';

            setlist.forEach((song, index) => {
                const li = document.createElement('li');
                li.style.display = 'flex';
                li.style.justifyContent = 'space-between';
                li.style.alignItems = 'center';
                li.style.padding = '10px';
                li.style.marginBottom = '8px';
                li.style.background = '#f5f7fa';
                li.style.borderRadius = '5px';
                li.setAttribute('draggable', 'true');
                li.dataset.songId = song.id;

                li.innerHTML = `
                    <span><span class="setlist-index">${index + 1}.</span>${song.title} (${song.key} | ${song.genre})</span>
                    <div class="song-actions">
                        <button class="btn btn-primary" onclick="removeFromSetlist(${song.id}, '${category}')">Remove</button>
                    </div>
                `;

                li.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('btn')) {
                        showPreview(song);
                    }
                });

                li.addEventListener("dragstart", e => {
                    li.classList.add("dragging");
                    e.dataTransfer.effectAllowed = "move";
                });

                li.addEventListener("dragend", () => {
                    li.classList.remove("dragging");
                    updateSetlistOrder();
                });

                li.addEventListener("dragover", e => {
                    e.preventDefault();
                    const dragging = container.querySelector(".dragging");
                    const afterElement = getDragAfterElement(container, e.clientY);
                    if (afterElement == null) {
                        container.appendChild(dragging);
                    } else {
                        container.insertBefore(dragging, afterElement);
                    }
                });

                ul.appendChild(li);
            });

            container.appendChild(ul);

            function getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll("li:not(.dragging)")];

                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }

            function updateSetlistOrder() {
                const reordered = Array.from(container.querySelectorAll("li")).map(li => {
                    const id = parseInt(li.dataset.songId);
                    return setlist.find(song => song.id === id);
                });

                if (category === 'praise') {
                    praiseSetlist = reordered;
                } else {
                    worshipSetlist = reordered;
                }

                saveSetlists();
                makeSetlistDraggable(category);
            }
        }

        window.renderSetlist = makeSetlistDraggable;
    });
</script>


<script>
    document.addEventListener("DOMContentLoaded", () => {
        window.renderSetlist = function(category) {
            const container = category === 'praise' ? document.getElementById('praiseSetlistSongs') : document.getElementById('worshipSetlistSongs');
            const setlist = category === 'praise' ? praiseSetlist : worshipSetlist;

            container.innerHTML = '';
            if (setlist.length === 0) {
                container.innerHTML = `<p>Your ${category} setlist is empty.</p>`;
                return;
            }

            const ul = document.createElement('ul');
            ul.className = 'setlist-sortable';
            ul.style.listStyle = 'none';
            ul.style.padding = '0';

            setlist.forEach((song, index) => {
                const li = document.createElement('li');
                li.style.display = 'flex';
                li.style.justifyContent = 'space-between';
                li.style.alignItems = 'center';
                li.style.padding = '10px';
                li.style.marginBottom = '8px';
                li.style.background = '#f5f7fa';
                li.style.borderRadius = '5px';
                li.setAttribute('draggable', 'true');
                li.dataset.songId = song.id;

                li.innerHTML = `
                    <span><span class="setlist-index">${index + 1}.</span> ${song.title} (${song.key} | ${song.genre})</span>
                    <div class="song-actions">
                        <button class="btn btn-primary" onclick="removeFromSetlist(${song.id}, '${category}')">Remove</button>
                    </div>
                `;

                li.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('btn')) {
                        showPreview(song);
                    }
                });

                ul.appendChild(li);
            });

            container.appendChild(ul);

            enableDrag(container, category);
        };

        function enableDrag(container, category) {
            let draggedItem = null;

            container.querySelectorAll("li").forEach(item => {
                item.addEventListener("dragstart", e => {
                    draggedItem = item;
                    setTimeout(() => item.style.display = "none", 0);
                });

                item.addEventListener("dragend", () => {
                    item.style.display = "flex";
                    draggedItem = null;
                    updateSetlistOrder(container, category);
                });

                item.addEventListener("dragover", e => {
                    e.preventDefault();
                    const bounding = item.getBoundingClientRect();
                    const offset = e.clientY - bounding.top + (bounding.height / 2);
                    if (offset > bounding.height / 2) {
                        item.parentNode.insertBefore(draggedItem, item.nextSibling);
                    } else {
                        item.parentNode.insertBefore(draggedItem, item);
                    }
                });
            });
        }

        function updateSetlistOrder(container, category) {
            const ids = Array.from(container.querySelectorAll("li")).map(li => parseInt(li.dataset.songId));
            const fullList = category === 'praise' ? praiseSetlist : worshipSetlist;
            const newList = ids.map(id => fullList.find(song => song.id === id));

            if (category === 'praise') {
                praiseSetlist = newList;
            } else {
                worshipSetlist = newList;
            }

            saveSetlists();
            renderSetlist(category);
        }
    });
</script>


<style>
    .lyrics-bg-praise {
        background-color: #e8f4fd; /* light blue */
    }

    .lyrics-bg-worship {
        background-color: #fdf3e8; /* light peach */
    }
</style>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        function applyLyricsBackground(isPraise) {
            const lyricsContainer = document.querySelector(".song-lyrics");
            if (!lyricsContainer) return;
            lyricsContainer.classList.remove("lyrics-bg-praise", "lyrics-bg-worship");
            lyricsContainer.classList.add(isPraise ? "lyrics-bg-praise" : "lyrics-bg-worship");
        }

        // Apply initial state based on tab
        applyLyricsBackground(document.getElementById('praiseTab').classList.contains('active'));

        // Hook into tab switch
        const praiseTab = document.getElementById('praiseTab');
        const worshipTab = document.getElementById('worshipTab');

        praiseTab.addEventListener("click", () => applyLyricsBackground(true));
        worshipTab.addEventListener("click", () => applyLyricsBackground(false));

        // Also apply during preview rendering
        const originalShowPreview = window.showPreview;
        window.showPreview = function(song) {
            originalShowPreview(song);
            const isPraise = song.category === 'praise';
            applyLyricsBackground(isPraise);
        };
    });
</script>

</body>
</html>
